import{render as ce}from"https://esm.sh/preact@10.22.1";import{useState as S,useEffect as de,useMemo as k}from"https://esm.sh/preact@10.22.1/hooks";(function(){const P=document.createElement("link").relList;if(P&&P.supports&&P.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))I(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const j of u.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&I(j)}).observe(document,{childList:!0,subtree:!0});function a(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function I(i){if(i.ep)return;i.ep=!0;const u=a(i);fetch(i.href,u)}})();var T={exports:{}},q={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B;function ue(){if(B)return q;B=1;var m=Symbol.for("react.transitional.element"),P=Symbol.for("react.fragment");function a(I,i,u){var j=null;if(u!==void 0&&(j=""+u),i.key!==void 0&&(j=""+i.key),"key"in i){u={};for(var A in i)A!=="key"&&(u[A]=i[A])}else u=i;return i=u.ref,{$$typeof:m,type:I,key:j,ref:i!==void 0?i:null,props:u}}return q.Fragment=P,q.jsx=a,q.jsxs=a,q}var X;function pe(){return X||(X=1,T.exports=ue()),T.exports}var e=pe();const H=["#ffadad","#ffd6a5","#fdffb6","#caffbf","#9bf6ff","#a0c4ff","#bdb2ff","#ffc6ff","#f0e68c","#ffdab9","#e6e6fa","#b0e0e6","#d8bfd8","#c1e1c1","#f5e3e6","#e2d2f2"],me=()=>{const[m,P]=S({inflationRate:2.5,educationInflationRate:6,loanInterestRate:3.8,expectedReturnRate:2.5,postRetirementInflationRate:2,postRetirementExpectedReturnRate:3}),[a,I]=S({clientAge:25,spouseAge:22,clientIncome:300,spouseIncome:250,clientPension:80,spousePension:70,clientRetirementAge:60,spouseRetirementAge:57,clientLifeExpectancy:90,spouseLifeExpectancy:90,clientSalaryIncreaseRate:3,spouseSalaryIncreaseRate:2.5,children:[{age:-4}]}),[i,u]=S([{id:1,name:"결혼자금",timing:3,requiredFunds:5e3,currentSavings:2e3,savingStart:0,savingPeriod:3},{id:2,name:"전세자금",timing:3,requiredFunds:5e3,currentSavings:0,savingStart:0,savingPeriod:3},{id:3,name:"주택마련",timing:11,requiredFunds:2e4,currentSavings:0,savingStart:3,savingPeriod:8},{id:4,name:"대출상환",timing:11,requiredFunds:2e4,currentSavings:0,savingStart:11,savingPeriod:20},{id:5,name:"첫째대학",timing:24,requiredFunds:5e3,currentSavings:0,savingStart:11,savingPeriod:13},{id:6,name:"둘째대학",timing:26,requiredFunds:5e3,currentSavings:0,savingStart:11,savingPeriod:15},{id:7,name:"첫째결혼",timing:34,requiredFunds:1e4,currentSavings:0,savingStart:24,savingPeriod:10},{id:8,name:"둘째결혼",timing:36,requiredFunds:1e4,currentSavings:0,savingStart:26,savingPeriod:10},{id:9,name:"은퇴자금",timing:35,requiredFunds:100,currentSavings:0,savingStart:24,savingPeriod:11},{id:10,name:"은퇴자금2",timing:35,requiredFunds:100,currentSavings:0,savingStart:24,savingPeriod:11}]),[j,A]=S(null),[z,w]=S(null),[E,C]=S(null),[Q,$]=S(null),[D,G]=S([!1,!1,!1]),[L,_]=S([null,null,null]);de(()=>{const t=[],n=[];[1,2,3].forEach(s=>{const d=localStorage.getItem(`financialPlan_${s}`);if(d){t.push(!0);try{const p=JSON.parse(d);typeof p.totalSavingsPrincipal=="number"?n.push(p.totalSavingsPrincipal):n.push(null)}catch{n.push(null)}}else t.push(!1),n.push(null)}),G(t),_(n)},[]);const Y=k(()=>{const t=(d,p,g,h)=>{const R=Math.max(0,p-d),r=h/100;let l=0;for(let o=0;o<R;o++){const c=g*12*Math.pow(1+r,o);l+=c}return l},n=t(a.clientAge,a.clientRetirementAge,a.clientIncome,a.clientSalaryIncreaseRate),s=t(a.spouseAge,a.spouseRetirementAge,a.spouseIncome,a.spouseSalaryIncreaseRate);return{client:n,spouse:s}},[a]),F=(t,n)=>{P(s=>({...s,[t]:parseFloat(n)||0}))},v=(t,n)=>{I(s=>({...s,[t]:parseFloat(n)||0}))},U=()=>{I(t=>({...t,children:[...t.children,{age:0}]}))},W=t=>{I(n=>({...n,children:n.children.filter((s,d)=>d!==t)}))},Z=(t,n)=>{const s=[...a.children];s[t]={age:parseInt(n,10)||0},I(d=>({...d,children:s}))},K=()=>{u([...i,{id:Date.now(),name:"",timing:0,requiredFunds:0,currentSavings:0,savingStart:0,savingPeriod:0}])},ee=t=>{u(i.filter(n=>n.id!==t))},N=(t,n,s)=>{u(i.map(d=>{if(d.id!==t)return d;if(typeof s=="string"&&n!=="name"){const p=s.replace(/,/g,""),g=parseFloat(p);return n==="lumpSumReturnRate"||n==="periodicReturnRate"?{...d,[n]:isNaN(g)?void 0:g}:{...d,[n]:isNaN(g)?0:g}}return{...d,[n]:s}}))},x=t=>isNaN(t)||!isFinite(t)?"0":Math.round(t).toLocaleString("ko-KR"),te=(t,n)=>{C(n),t.dataTransfer.setData("text/plain",n.toString()),t.dataTransfer.effectAllowed="move"},ne=(t,n)=>{t.preventDefault(),n!==E&&$(n)},se=t=>{t.preventDefault()},re=(t,n)=>{if(t.preventDefault(),E===null||E===n){$(null),C(null);return}const s=i.findIndex(h=>h.id===E),d=i.findIndex(h=>h.id===n);if(s===-1||d===-1)return;const p=[...i],[g]=p.splice(s,1);p.splice(d,0,g),u(p),C(null),$(null)},ae=()=>{C(null),$(null)},ie=t=>{const n=b.reduce((g,h)=>{const R=(h.savingPeriod||0)*(h.monthlyPayment||0)*12;return g+R},0),s={personalInfo:a,economicAssumptions:m,goals:i,totalSavingsPrincipal:n};localStorage.setItem(`financialPlan_${t+1}`,JSON.stringify(s));const d=[...D];d[t]=!0,G(d);const p=[...L];p[t]=n,_(p),alert(`플랜 ${t+1}이(가) 저장되었습니다.`)},le=t=>{const n=localStorage.getItem(`financialPlan_${t+1}`);if(n)try{const s=JSON.parse(n);s.personalInfo&&s.economicAssumptions&&s.goals?(I(s.personalInfo),P(s.economicAssumptions),u(s.goals),alert(`플랜 ${t+1}을(를) 복구했습니다.`)):alert("저장된 데이터 형식이 올바르지 않습니다.")}catch(s){console.error("Failed to parse plan data:",s),alert("데이터를 복구하는 중 오류가 발생했습니다.")}},b=k(()=>i.map(t=>{const n={...t};for(const l in n)typeof n[l]=="number"&&(n[l]=n[l]||0);const s=(n.lumpSumReturnRate??m.expectedReturnRate)/100,d=(n.periodicReturnRate??m.expectedReturnRate)/100;let p;if(n.name.includes("은퇴")){const o=n.requiredFunds*12,c=m.inflationRate/100,f=o*Math.pow(1+c,n.timing),y=Math.max(0,a.clientLifeExpectancy-a.clientRetirementAge),M=m.postRetirementExpectedReturnRate/100,O=m.postRetirementInflationRate/100,V=y;M<=O?p=f*V:p=f*(1-Math.pow((1+O)/(1+M),V))/(M-O)}else if(n.name.includes("대출상환"))p=n.requiredFunds;else{let l=m.inflationRate/100;n.name.includes("대학")&&(l=m.educationInflationRate/100),p=n.requiredFunds*Math.pow(1+l,n.timing)}const g=n.currentSavings*Math.pow(1+s,n.timing),h=Math.max(0,p-g);let R=0;const r=n.timing-n.savingStart-n.savingPeriod;if(n.name.includes("대출상환")){const l=n.requiredFunds,o=m.loanInterestRate/100/12,c=n.savingPeriod*12;if(c>0&&o>0){const f=Math.pow(1+o,c);R=l*(o*f)/(f-1)}else c>0&&(R=l/c)}else{const l=h/Math.pow(1+s,r),o=d/12,c=n.savingPeriod*12;c>0&&(o>0?R=l*(o/(Math.pow(1+o,c)-1)):R=l/c)}return{...n,futureValueRequired:p,futureValueCurrent:g,shortfall:h,monthlyPayment:R,holdingPeriod:r}}),[i,m,a]),J=k(()=>b.reduce((t,n)=>(t.currentSavings+=n.currentSavings,n.savingStart===0&&(t.monthlyPayment+=n.monthlyPayment),t),{currentSavings:0,monthlyPayment:0}),[b]),oe=()=>{if(b.length===0)return null;const t=Math.max(...b.map(r=>(r.savingStart||0)+(r.savingPeriod||0)),...b.map(r=>r.timing||0),0);if(t===0)return e.jsx("p",{children:"그래프를 표시하려면 목표 시기를 입력하세요."});const n=Array.from({length:t},(r,l)=>({year:l+1,total:0,goals:{}})),s=new Map;b.forEach((r,l)=>{s.set(r.id,H[l%H.length])}),b.forEach((r,l)=>{const o=r.savingStart||0,c=o+r.savingPeriod,f=s.get(r.id);for(let y=o;y<c;y++)n[y]&&(n[y].total+=r.monthlyPayment,n[y].goals[r.id]||(n[y].goals[r.id]={name:r.name||`목표 ${l+1}`,payment:0,color:f}),n[y].goals[r.id].payment+=r.monthlyPayment)});const d=Array.from({length:t},(r,l)=>{const o=l+1;let c=0;a.clientAge+o<=a.clientRetirementAge&&(c=a.clientIncome*Math.pow(1+a.clientSalaryIncreaseRate/100,l));let f=0;return a.spouseAge+o<=a.spouseRetirementAge&&(f=a.spouseIncome*Math.pow(1+a.spouseSalaryIncreaseRate/100,l)),c+f}),p=Math.max(...n.map(r=>r.total),0),g=Math.max(...d,0),h=Math.max(p,g),R=d.map((r,l)=>{const o=(l+.5)/t*100,c=100-(h>0?r/h*100:0);return`${o},${c}`}).join(" ");return h===0?e.jsx("p",{children:"월 필요적립금 또는 소득이 계산되면 그래프가 표시됩니다."}):e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-legend",children:[b.map(r=>e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-color",style:{backgroundColor:s.get(r.id)}}),r.name]},r.id)),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-line"}),"부부 합산 월소득"]})]}),e.jsx("div",{className:"chart",children:e.jsxs("div",{className:"bars-container",children:[e.jsx("div",{className:"bars",onClick:()=>{A(null),w(null)},children:n.map(r=>e.jsxs("div",{className:"bar-wrapper",children:[r.total>0&&e.jsx("span",{className:"bar-value",style:{bottom:`${r.total/h*100}%`},children:x(r.total)}),e.jsx("div",{className:"bar",style:{height:h>0?`${r.total/h*100}%`:"0%"},children:Object.entries(r.goals).map(([l,o])=>{const c=parseInt(l,10),f=r.total>0?o.payment/r.total*100:0;return e.jsx("div",{className:`bar-segment ${j!==null&&j!==c?"dimmed":""}`,style:{height:`${f}%`,backgroundColor:o.color},title:`${o.name}: ${x(o.payment)}`,onClick:y=>{y.stopPropagation(),A(M=>M===c?null:c)}},c)})}),e.jsxs("span",{className:"x-axis-label",children:[r.year,"년"]})]},r.year))}),e.jsxs("svg",{className:"line-chart-svg",preserveAspectRatio:"none",viewBox:"0 0 100 100",children:[e.jsx("polyline",{points:R}),d.map((r,l)=>{if(r<=0)return null;const o=(l+.5)/t*100,c=100-(h>0?r/h*100:0);return e.jsxs("g",{className:"marker-group",onMouseEnter:()=>w(l),onMouseLeave:()=>w(null),children:[e.jsx("ellipse",{className:"marker",cx:o,cy:c,rx:"0.53",ry:"0.8"}),z===l&&e.jsx("text",{x:o,y:c,dy:"-1.5",className:"line-chart-label",children:x(r)})]},`marker-group-${l}`)})]})]})})]})};return e.jsxs("div",{className:"container","aria-labelledby":"app-title",children:[e.jsx("header",{children:e.jsx("h1",{id:"app-title",children:"재무 목표 분석기"})}),e.jsxs("main",{children:[e.jsxs("section",{className:"settings","aria-labelledby":"economic-assumptions-title",children:[e.jsx("h2",{id:"economic-assumptions-title",children:"경제가정치"}),e.jsxs("div",{className:"settings-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inflation-rate",children:"물가상승률 (%)"}),e.jsx("input",{type:"number",id:"inflation-rate",value:m.inflationRate,onInput:t=>F("inflationRate",t.target.value),step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"education-inflation-rate",children:"교육비상승률 (%)"}),e.jsx("input",{type:"number",id:"education-inflation-rate",value:m.educationInflationRate,onInput:t=>F("educationInflationRate",t.target.value),step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"loan-interest-rate",children:"대출이율 (%)"}),e.jsx("input",{type:"number",id:"loan-interest-rate",value:m.loanInterestRate,onInput:t=>F("loanInterestRate",t.target.value),step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"expected-return-rate",children:"기대수익률 (%)"}),e.jsx("input",{type:"number",id:"expected-return-rate",value:m.expectedReturnRate,onInput:t=>F("expectedReturnRate",t.target.value),step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"post-retirement-inflation-rate",children:"은퇴후물가상승률 (%)"}),e.jsx("input",{type:"number",id:"post-retirement-inflation-rate",value:m.postRetirementInflationRate,onInput:t=>F("postRetirementInflationRate",t.target.value),step:"0.1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"post-retirement-expected-return-rate",children:"은퇴후기대수익률 (%)"}),e.jsx("input",{type:"number",id:"post-retirement-expected-return-rate",value:m.postRetirementExpectedReturnRate,onInput:t=>F("postRetirementExpectedReturnRate",t.target.value),step:"0.1"})]})]})]}),e.jsxs("section",{className:"settings","aria-labelledby":"personal-info-title",children:[e.jsx("h2",{id:"personal-info-title",children:"인적사항"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"personal-info-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"항목"}),e.jsx("th",{children:"나이"}),e.jsx("th",{children:"월소득"}),e.jsx("th",{children:"국민연금예상"}),e.jsx("th",{children:"은퇴시점"}),e.jsx("th",{children:"기대여명"}),e.jsx("th",{children:"급여상승률(%)"}),e.jsx("th",{children:"예상총소득"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"고객"}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientAge,onInput:t=>v("clientAge",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientIncome,onInput:t=>v("clientIncome",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientPension,onInput:t=>v("clientPension",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientRetirementAge,onInput:t=>v("clientRetirementAge",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientLifeExpectancy,onInput:t=>v("clientLifeExpectancy",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.clientSalaryIncreaseRate,onInput:t=>v("clientSalaryIncreaseRate",t.target.value),step:"0.1"})}),e.jsx("td",{children:x(Y.client)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"배우자"}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spouseAge,onInput:t=>v("spouseAge",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spouseIncome,onInput:t=>v("spouseIncome",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spousePension,onInput:t=>v("spousePension",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spouseRetirementAge,onInput:t=>v("spouseRetirementAge",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spouseLifeExpectancy,onInput:t=>v("spouseLifeExpectancy",t.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:a.spouseSalaryIncreaseRate,onInput:t=>v("spouseSalaryIncreaseRate",t.target.value),step:"0.1"})}),e.jsx("td",{children:x(Y.spouse)})]})]})]})}),e.jsxs("div",{className:"children-info",children:[a.children.map((t,n)=>e.jsxs("div",{className:"form-group child-group",children:[e.jsxs("label",{htmlFor:`child${n}-age`,children:["자녀",n+1]}),e.jsx("input",{type:"number",id:`child${n}-age`,value:t.age,onInput:s=>Z(n,s.target.value)}),e.jsx("button",{onClick:()=>W(n),className:"remove-btn-small","aria-label":`자녀 ${n+1} 삭제`,children:"X"})]},n)),e.jsx("button",{onClick:U,className:"add-btn-small",children:"+ 자녀 추가"})]})]}),e.jsxs("section",{className:"goals-table","aria-labelledby":"goals-title",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{id:"goals-title",children:"재무 목표 입력"}),e.jsx("button",{onClick:K,className:"add-btn",children:"+ 목표 추가"})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"재무목표"}),e.jsx("th",{children:"시기"}),e.jsx("th",{children:"필요자금"}),e.jsx("th",{children:"기필요자금"}),e.jsx("th",{children:"현재준비"}),e.jsx("th",{children:"기준비자금"}),e.jsx("th",{children:"필요차액"}),e.jsx("th",{children:"저축시작"}),e.jsx("th",{children:"저축기간"}),e.jsx("th",{children:"월적립금"}),e.jsx("th",{children:"거치기간"}),e.jsx("th",{children:"거치수익률"}),e.jsx("th",{children:"적립수익률"}),e.jsx("th",{children:"삭제"})]})}),e.jsx("tbody",{children:b.map((t,n)=>e.jsxs("tr",{draggable:!0,onDragStart:s=>te(s,t.id),onDragEnter:s=>ne(s,t.id),onDragOver:se,onDrop:s=>re(s,t.id),onDragEnd:ae,className:`${t.id===j?"highlighted-row":""} ${t.id===E?"dragging":""} ${t.id===Q?"drag-over":""}`,children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:t.name,onInput:s=>N(t.id,"name",s.target.value),placeholder:`목표 ${n+1}`})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.timing,onInput:s=>N(t.id,"timing",s.target.value),step:"1"})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:x(t.requiredFunds),onInput:s=>N(t.id,"requiredFunds",s.target.value)})}),e.jsx("td",{children:x(t.futureValueRequired)}),e.jsx("td",{children:e.jsx("input",{type:"text",value:x(t.currentSavings),onInput:s=>N(t.id,"currentSavings",s.target.value)})}),e.jsx("td",{children:x(t.futureValueCurrent)}),e.jsx("td",{children:x(t.shortfall)}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.savingStart,onInput:s=>N(t.id,"savingStart",s.target.value),step:"1"})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.savingPeriod,onInput:s=>N(t.id,"savingPeriod",s.target.value),step:"1"})}),e.jsx("td",{className:"highlight",children:x(t.monthlyPayment)}),e.jsx("td",{children:x(t.holdingPeriod)}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.1",value:t.lumpSumReturnRate??m.expectedReturnRate,onInput:s=>N(t.id,"lumpSumReturnRate",s.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.1",value:t.periodicReturnRate??m.expectedReturnRate,onInput:s=>N(t.id,"periodicReturnRate",s.target.value)})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>ee(t.id),className:"remove-btn","aria-label":`${t.name} 목표 삭제`,children:"X"})})]},t.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,children:e.jsx("strong",{children:"합계"})}),e.jsx("td",{children:e.jsx("strong",{children:x(J.currentSavings)})}),e.jsx("td",{children:"-"}),e.jsx("td",{children:"-"}),e.jsx("td",{colSpan:2,children:"-"}),e.jsx("td",{className:"highlight",children:e.jsx("strong",{children:x(J.monthlyPayment)})}),e.jsx("td",{colSpan:4})]})})]})})]}),e.jsx("section",{className:"plan-management","aria-label":"플랜 관리",children:e.jsx("div",{className:"plan-slots",children:[0,1,2].map(t=>e.jsxs("div",{className:"plan-slot",children:[e.jsxs("span",{className:"plan-label",children:["플랜 ",t+1]}),e.jsx("button",{onClick:()=>ie(t),children:"저장"}),e.jsx("button",{onClick:()=>le(t),disabled:!D[t],children:"복구"}),L[t]!==null&&e.jsxs("span",{className:"plan-total-savings",children:["총저축 원금: ",x(L[t])]})]},t))})}),e.jsxs("section",{className:"results","aria-labelledby":"chart-title",children:[e.jsx("h2",{id:"chart-title",children:"분석 그래프"}),oe()]})]})]})};ce(e.jsx(me,{}),document.getElementById("root"));
